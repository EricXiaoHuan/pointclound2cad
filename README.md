# 点云数据转CAD 3D模型系统

[English](README_EN.md) | 简体中文

## 项目简介

本项目是一个基于C++和Qt的点云数据转CAD 3D模型系统，支持点云数据的交互处理、可视化重建和CAD模型导出。

## 系统功能

### 核心功能
- **数据导入导出**：支持多种点云格式（.ply、.obj、.xyz、.pcd、.las）和CAD模型格式（.stl、.obj、.step、.iges）的导入导出
- **批量处理**：支持批量导入多个点云文件，批量处理和导出数据
- **点云预处理**：实现统计滤波、半径滤波、体素网格下采样、均匀采样、随机采样等多种点云预处理算法
- **点云分割**：支持平面分割、欧氏聚类分割、区域生长分割、RGB区域生长分割等点云分割算法
- **点云配准**：实现ICP、GICP、SAC-IA、NDT等多种点云配准算法
- **特征提取**：支持FPFH、SHOT等点云特征提取算法
- **表面重建**：支持泊松重建、贪婪三角化等表面重建算法
- **模型优化**：实现网格简化、平滑等模型优化算法
- **测量工具**：支持距离、角度、面积、体积等测量功能
- **项目管理**：支持创建、打开、保存项目文件
- **日志记录**：提供操作日志窗口，实时记录系统操作和错误信息
- **可视化交互**：提供点云数据和3D模型的实时可视化，支持视角控制、缩放、旋转等交互操作

### 用户界面
- **菜单栏**：包含文件、编辑、视图、工具、帮助等菜单，新增项目管理、批处理、测量工具等子菜单
- **工具栏**：提供常用操作的快捷按钮
- **3D视图**：显示点云数据和3D模型，支持多种渲染模式，新增多视图布局功能
- **侧边栏**：包含数据管理、参数设置、工具选项等面板
- **状态栏**：显示系统状态、处理进度、坐标信息和缩放比例
- **日志窗口**：实时显示操作记录和错误信息，可通过视图菜单切换显示/隐藏

## 项目结构

```
pointcloud2cad/
├── src/                  # 源代码目录
│   ├── algorithm/        # 算法模块
│   │   ├── PointCloudProcessor.h
│   │   └── PointCloudProcessor.cpp
│   ├── data/             # 数据管理模块
│   │   ├── DataManager.h
│   │   ├── DataManager.cpp
│   │   ├── IOManager.h
│   │   └── IOManager.cpp
│   ├── visualization/    # 可视化模块
│   │   ├── VisualizationWidget.h
│   │   └── VisualizationWidget.cpp
│   ├── ui/               # 用户界面模块
│   │   ├── MainWindow.h
│   │   └── MainWindow.cpp
│   ├── core/             # 核心模块
│   ├── utils/            # 工具模块
│   └── main.cpp          # 主函数
├── CMakeLists.txt        # CMake配置文件
├── 开发需求文档.md        # 开发需求文档
├── 技术架构与实现方案.md  # 技术架构与实现方案
└── README.md             # 项目说明文档
```

## 技术栈

- **C++17**：核心编程语言
- **Qt 5.15+**：图形用户界面框架
- **PCL 1.12+**：点云处理库，包含features、segmentation、registration等模块
- **CGAL 5.4+**：计算几何算法库
- **OpenGL**：图形渲染API
- **Assimp**：3D模型导入导出库
- **Eigen3**：线性代数库
- **Boost**：通用工具库
- **CMake**：构建系统

## 项目架构

本项目采用分层架构设计，包括以下层次：

### 1. 数据层
- **DataManager**：负责管理点云数据和3D模型数据，提供数据的添加、删除、查询等操作
- **IOManager**：负责文件的导入导出，支持多种文件格式，包括批量处理功能

### 2. 核心处理层
- **PointCloudProcessor**：实现点云处理的核心算法，包括：
  - 预处理算法：统计滤波、半径滤波、体素网格下采样、均匀采样、随机采样
  - 特征提取：FPFH、SHOT
  - 分割算法：平面分割、欧氏聚类分割、区域生长分割、RGB区域生长分割
  - 配准算法：ICP、GICP、SAC-IA、NDT
  - 重建算法：泊松重建、贪婪三角化
  - 优化算法：移动最小二乘平滑
  - 分析算法：质心计算、边界框计算

### 3. 可视化层
- **VisualizationWidget**：负责点云数据和3D模型的OpenGL渲染，提供交互操作，支持多视图布局

### 4. 用户界面层
- **MainWindow**：主窗口类，包含菜单栏、工具栏、3D视图、侧边栏等组件
- **测量工具**：实现距离、角度、面积、体积测量功能
- **项目管理**：实现项目的创建、打开、保存功能
- **日志系统**：实现操作日志的记录和显示

### 5. 工具层
- **各种工具类**：提供辅助功能，如参数设置、进度显示等

## 构建环境

### 硬件要求
- CPU：至少4核，推荐8核以上
- 内存：至少8GB，推荐16GB以上
- GPU：支持OpenGL 4.5+，推荐独立显卡

### 软件要求
- 操作系统：Windows 10/11 64位
- 编译器：Visual Studio 2019+ 或 MinGW 8.0+
- CMake：3.16+
- Qt：5.15+（包含Widgets、Core、Gui模块）
- PCL：1.12+（包含common、io、filters、segmentation、registration、surface、features模块）
- CGAL：5.4+
- Assimp：5.1+
- Eigen3：3.3+
- Boost：1.70+

## 构建步骤

### 使用Visual Studio构建
1. 安装所有依赖库
2. 克隆项目代码到本地
3. 创建build目录并进入
4. 运行CMake生成Visual Studio项目：
   ```bash
   cmake .. -G "Visual Studio 17 2022" -A x64
   ```
5. 打开生成的.sln文件，编译项目
6. 运行生成的可执行文件

### 使用MinGW构建
1. 安装所有依赖库
2. 克隆项目代码到本地
3. 创建build目录并进入
4. 运行CMake生成MinGW Makefiles：
   ```bash
   cmake .. -G "MinGW Makefiles"
   ```
5. 运行mingw32-make编译项目：
   ```bash
   mingw32-make
   ```
6. 运行生成的可执行文件

## 使用说明

### 基本操作
1. **导入点云数据**：点击菜单栏的"文件"->"打开"，选择点云文件（.ply、.obj、.xyz、.pcd、.las）
2. **批量导入**：点击菜单栏的"工具"->"批处理"->"批量导入"，选择多个点云文件
3. **点云滤波**：在左侧工具面板中点击"滤波"按钮，系统会自动对当前点云进行统计滤波
4. **点云分割**：在左侧工具面板中点击"分割"按钮，系统会对当前点云进行欧氏聚类分割
5. **点云配准**：在左侧工具面板中点击"配准"按钮，系统会对多个点云进行配准
6. **点云重建**：在左侧工具面板中点击"重建"按钮，系统会使用泊松算法对当前点云进行表面重建
7. **模型优化**：在左侧工具面板中点击"优化"按钮，系统会对当前模型进行优化
8. **导出CAD模型**：点击菜单栏的"文件"->"导出"，选择CAD模型格式（.stl、.obj、.step、.iges）
9. **批量导出**：点击菜单栏的"工具"->"批处理"->"批量导出"，选择导出目录

### 项目管理
1. **新建项目**：点击菜单栏的"文件"->"项目"->"新建项目"
2. **打开项目**：点击菜单栏的"文件"->"项目"->"打开项目"，选择项目文件（.pc2cad）
3. **保存项目**：点击菜单栏的"文件"->"项目"->"保存项目"，选择保存路径

### 测量工具
1. **距离测量**：点击菜单栏的"工具"->"测量工具"->"距离测量"，在3D视图中选择两个点
2. **角度测量**：点击菜单栏的"工具"->"测量工具"->"角度测量"，在3D视图中选择三个点
3. **面积测量**：点击菜单栏的"工具"->"测量工具"->"面积测量"，在3D视图中选择多个点
4. **体积测量**：点击菜单栏的"工具"->"测量工具"->"体积测量"，选择一个闭合网格模型

### 可视化操作
- **旋转视角**：按住鼠标左键并拖动
- **缩放视角**：使用鼠标滚轮
- **平移视角**：按住鼠标中键并拖动
- **预设视角**：点击菜单栏的"视图"->"预设视角"，选择预设视角（俯视图、仰视图、前视图、后视图、左视图、右视图、等轴测视图）
- **多视图布局**：点击菜单栏的"视图"->"多视图布局"，选择布局模式（单视图、双视图、四视图）
- **视图控制**：点击菜单栏的"视图"，使用重置视图、放大、缩小等功能

### 日志记录
- **显示操作日志**：点击菜单栏的"视图"->"显示操作日志"，打开日志窗口
- **查看操作记录**：在日志窗口中查看系统操作记录和错误信息

### 参数设置
- **滤波参数**：在右侧参数设置面板中调整统计滤波的近邻点数量和标准差阈值
- **重建参数**：在右侧参数设置面板中调整泊松重建的深度、点权重和尺度
- **渲染参数**：在右侧参数设置面板中调整点大小、线宽和渲染模式

## 示例数据

### 点云数据示例
- **bunny.ply**：兔子模型的点云数据
- **dragon.ply**：龙模型的点云数据
- **teapot.ply**：茶壶模型的点云数据

### CAD模型示例
- **bunny.stl**：兔子模型的STL格式
- **dragon.obj**：龙模型的OBJ格式
- **teapot.step**：茶壶模型的STEP格式

## 常见问题

### 问题：无法加载点云文件
**解决方案**：
1. 检查文件格式是否支持
2. 检查文件路径是否正确
3. 检查文件是否损坏

### 问题：点云滤波效果不佳
**解决方案**：
1. 调整滤波参数，增加近邻点数量或减小标准差阈值
2. 尝试使用其他滤波算法，如半径滤波

### 问题：重建模型质量不佳
**解决方案**：
1. 调整重建参数，增加重建树深度
2. 对原始点云进行更好的预处理，如平滑和去噪
3. 尝试使用其他重建算法，如贪婪三角化

### 问题：可视化窗口卡顿
**解决方案**：
1. 对点云数据进行下采样，减少点的数量
2. 减小点大小或线宽
3. 关闭不必要的渲染效果

## 项目团队

- **项目负责人**：XXX
- **算法工程师**：XXX
- **软件工程师**：XXX
- **UI设计师**：XXX

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

- **邮箱**：980139383@qq.com
- **GitHub**：https://github.com/EricXiaoHuan/pointclound2cad

## 致谢

本项目使用了以下开源库：
- [PCL (Point Cloud Library)](https://pointclouds.org/)
- [CGAL (Computational Geometry Algorithms Library)](https://www.cgal.org/)
- [Qt](https://www.qt.io/)
- [Assimp](https://www.assimp.org/)
- [Eigen](https://eigen.tuxfamily.org/)
- [Boost](https://www.boost.org/)

感谢这些开源库的开发者和贡献者！

## 打赏支持

如果您觉得本项目对您有帮助，欢迎通过以下方式打赏支持项目开发：

|  |  |
|---------|-------|
| ![微信支付](images/wechat_pay_qrcode.jpg) | ![支付宝](images/alipay_qrcode.jpg) |